import{R as m,j as o,P as h,S as d,B as v,v as S,x as y,z as j,E as F,F as g,G as A}from"./index-BnbdzBXK.js";import{C as B}from"./Close-CboXMYl2.js";import{u as E,h as P}from"./FilterField-DMAwM7NW.js";import{C as b}from"./DataGrid-7_aY7HQM.js";import{u as w}from"./useQuery-cPuHdkqq.js";const z=({header:e="Filters",grouped:i=!0,onChange:n,onClose:c,config:u,children:t,...l})=>{const{activeFilters:r,dispatch:s}=E();let a=0;m.Children.forEach(t,p=>{if(m.isValidElement(p)&&p.props.field&&P(r.find(x=>x.field===p.props.field)))return a++});const f=()=>{s({type:"SET_ACTIVE_FILTERS",payload:[]})};return o.jsx(h,{elevation:0,variant:"outlined",...l,children:o.jsxs(d,{spacing:0,children:[e&&o.jsxs(d,{direction:"row",spacing:0,alignItems:"center",sx:{borderBottom:"1px solid",borderBottomColor:"grey.300",paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1},children:[o.jsxs(d,{direction:"row",spacing:2,flex:1,children:[o.jsx(v,{children:e}),a>0&&o.jsx(b,{label:`${a} active`,color:"primary",size:"small"})]}),o.jsx(S,{variant:"outlined",onClick:f,sx:{marginRight:1},children:"Reset"}),o.jsx(y,{onClick:c,children:o.jsx(B,{})})]}),i&&o.jsx(d,{spacing:0,children:t}),!i&&o.jsx(d,{spacing:2,sx:{padding:2},children:t})]})})},k=(e,i)=>{let n=e;return i&&(n=e.filter(c=>JSON.stringify(c).toLowerCase().indexOf(i.toLowerCase())>-1)),n},R=(e,i,n)=>{let c=e;if(e&&i.length>0){const u={};i.forEach(t=>{if(n){const l=n.find(r=>r.field===t.field);u[t.field]=l==null?void 0:l.operator}}),c=e.filter(t=>{let l=!0;return i.forEach(r=>{let s=!1;if(l===!0)switch(u[r.field]){case"contains":{t[r.field].indexOf(r.value)>-1&&(s=!0);break}case"contains-one-of":{Array.isArray(r.value)&&r.value.forEach(a=>{s||(Array.isArray(t[r.field])?t[r.field].indexOf(a)>-1&&(s=!0):t[r.field]===a&&(s=!0))});break}case"equals-one-of":{Array.isArray(r.value)&&r.value.forEach(a=>{s||t[r.field]===a&&(s=!0)});break}case"between-inclusive":{if(Array.isArray(r.value)){const a=r.value[0],f=r.value[1];t[r.field]>=a&&t[r.field]<=f&&(s=!0)}break}case"between-dates-inclusive":{if(typeof t[r.field]=="string"&&Array.isArray(r.value)&&r.value[0]&&r.value[1]){const a=j(t[r.field]);a.isAfter(r.value[0])&&a.isBefore(r.value[1])&&(s=!0)}else s=!0;break}}s||(l=!1)}),l})}return c},I=(e,i,n,c)=>{const u=k(e,c);return R(u,i,n)},M=e=>{let i=e.queryMode==="server"?F(e.activeFilters,e.filterConfigs):new URLSearchParams;e.staticParams&&Object.keys(e.staticParams).forEach(s=>{e.staticParams&&i.append(s,e.staticParams[s].toString())}),e.queryMode==="server"&&(i.append("limit",e.pageSize.toString()),i.append("offset",e.offset.toString()));const n=e.queryMode==="server"?[e.dataSource,{...e.activeFilters,pageSize:e.pageSize,offset:e.offset}]:[e.dataSource],{isPending:c,isFetching:u,isError:t,data:l,error:r}=w({queryKey:n,queryFn:async()=>{const s=i.toString();let a=e.dataSource;return s&&s.length>0&&(a=`${e.dataSource}?${s}`),await A(a)},placeholderData:g});return{isPending:c,isFetching:u,isError:t,data:l,error:r}};export{z as F,I as f,M as u};
